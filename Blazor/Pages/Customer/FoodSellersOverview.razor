@page "/FoodSellersOverview"
@using Domain
@using Domain.DTOs
@using System.Security.Claims
@using HttpClients.ClientInterfaces
@using Microsoft.AspNetCore.Components
@inject NavigationManager NavMgr
@inject IFoodSellerService FoodSellerService
@attribute [Authorize]
<AuthorizeView Policy="MustBeCustomer">
    @if (foodSellers == null)
    {
    }
    else if (!foodSellers.Any())
    {
        <p>No food sellers to display</p>
    }
    else
    {
        @foreach (var item in foodSellers)
        {
            <div class="card" style=" height: 200px; width: 100%" @onclick="@(() => NavMgr.NavigateTo($"/DisplayFoodSeller/{item.AccountId}"))">
                <h3>@item.Name</h3>
            </div>
        }
            
    }
    
</AuthorizeView>
@if (!string.IsNullOrEmpty(ErrorMessage))
{
    <label style="color: red">@ErrorMessage</label>
}

@code {
    private int AccountId;
    private List<ReadFoodSellerDTO> foodSellers;
    private string ErrorMessage = "";
    [CascadingParameter]
    public Task<AuthenticationState> AuthState { get; set; } = null!;
    private bool _isLoggedIn;
    private IEnumerable<Claim> userClaims;

    protected override async Task OnInitializedAsync()
    {
        AuthenticationState authState = await AuthState;
        ClaimsPrincipal user = authState.User;
        _isLoggedIn = user.Identity != null;
        if (!_isLoggedIn) return;
        userClaims = user.Claims.AsEnumerable();
        AccountId = Int32.Parse(userClaims.FirstOrDefault(c => c.Type.Equals("ID"))!.Value);
        foodSellers = await FoodSellerService.GetAllAsync();
    }
    
}